C51 COMPILER V9.54   MAIN                                                                  05/24/2024 23:11:42 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "LCD1602.h"
   3          
   4          #define DS1302_SECOND   0x80
   5          #define DS1302_MINUTE   0x82
   6          #define DS1302_HOUR     0x84
   7          #define DS1302_DATE     0x86
   8          #define DS1302_MONTH    0x88
   9          #define DS1302_DAY              0x8A
  10          #define DS1302_YEAR     0x8C
  11          #define DS1302_WP               0x8E
  12          
  13          sbit DS1302_SCLK = P3 ^ 6;
  14          sbit DS1302_IO = P3 ^ 4;
  15          sbit DS1302_CE = P3 ^ 5;
  16          
  17          // Delay for @11.0592MHz
  18          void DelayMs(unsigned int xms)
  19          {
  20   1              unsigned char i, j;
  21   1              
  22   1              while (xms--)
  23   1              {
  24   2                      for (i = 2; i > 0; i--)
  25   2                      {
  26   3                              for (j = 199; j > 0; j--);
  27   3                      }
  28   2              }
  29   1      }
  30          
  31          void InitDS1302(void)
  32          {
  33   1              DS1302_CE = 0;
  34   1              DS1302_SCLK = 0;
  35   1      }
  36          
  37          void WriteByteToDS1302(unsigned char Command, Data)
  38          {
  39   1              unsigned char i;
  40   1              
  41   1              DS1302_CE = 1;
  42   1              
  43   1              for (i = 0; i < 8; i++)
  44   1              {
  45   2                      DS1302_IO = Command & (0x01 << i);
  46   2                      DS1302_SCLK = 1;
  47   2                      DS1302_SCLK = 0;
  48   2              }
  49   1              
  50   1              for (i = 0; i < 8; i++)
  51   1              {
  52   2                      DS1302_IO = Data & (0x01 << i);
  53   2                      DS1302_SCLK = 1;
  54   2                      DS1302_SCLK = 0;
C51 COMPILER V9.54   MAIN                                                                  05/24/2024 23:11:42 PAGE 2   

  55   2              }
  56   1              
  57   1              DS1302_CE = 0;
  58   1      }
  59          
  60          unsigned char ReadByteFromDS1302(unsigned char Command)
  61          {
  62   1              unsigned char i, Data = 0x00;
  63   1              
  64   1              Command |= 0x01;
  65   1              DS1302_CE = 1;
  66   1              
  67   1              for (i = 0; i < 8; i++)
  68   1              {
  69   2                      DS1302_IO = Command & (0x01 << i);
  70   2                      DS1302_SCLK = 0;
  71   2                      DS1302_SCLK = 1;
  72   2              }
  73   1              
  74   1              for (i = 0; i < 8; i++)
  75   1              {
  76   2                      DS1302_SCLK = 1;
  77   2                      DS1302_SCLK = 0;
  78   2                      if (DS1302_IO)
  79   2                      {
  80   3                              Data |= (0x01 << i);
  81   3                      }
  82   2              }
  83   1              
  84   1              DS1302_CE = 0;
  85   1              DS1302_IO = 0;
  86   1              
  87   1              return Data;
  88   1      }
  89          
  90          unsigned char DS1302_Time[] = {19, 11, 16, 12, 59, 55, 6};
  91          
  92          unsigned char EncodeBCD(unsigned char BCD)
  93          {
  94   1              return BCD / 10 * 16 + BCD % 10;
  95   1      }
  96          
  97          unsigned char DecodeBCD(unsigned char BCD)
  98          {
  99   1              return BCD / 16 * 10 + BCD % 16;
 100   1      }
 101          
 102          void DS1302_SetTime()
 103          {
 104   1              WriteByteToDS1302(DS1302_WP, 0x00);
 105   1              WriteByteToDS1302(DS1302_YEAR, EncodeBCD(DS1302_Time[0]));
 106   1              WriteByteToDS1302(DS1302_MONTH, EncodeBCD(DS1302_Time[1]));
 107   1              WriteByteToDS1302(DS1302_DATE, EncodeBCD(DS1302_Time[2]));
 108   1              WriteByteToDS1302(DS1302_HOUR, EncodeBCD(DS1302_Time[3]));
 109   1              WriteByteToDS1302(DS1302_MINUTE, EncodeBCD(DS1302_Time[4]));
 110   1              WriteByteToDS1302(DS1302_SECOND, EncodeBCD(DS1302_Time[5]));
 111   1              WriteByteToDS1302(DS1302_DAY, EncodeBCD(DS1302_Time[6]));
 112   1              WriteByteToDS1302(DS1302_WP, 0x80);
 113   1      }
 114          
 115          void DS1302_ReadTime()
 116          {
C51 COMPILER V9.54   MAIN                                                                  05/24/2024 23:11:42 PAGE 3   

 117   1              DS1302_Time[0] = DecodeBCD(ReadByteFromDS1302(DS1302_YEAR));
 118   1              DS1302_Time[1] = DecodeBCD(ReadByteFromDS1302(DS1302_MONTH));
 119   1              DS1302_Time[2] = DecodeBCD(ReadByteFromDS1302(DS1302_DATE));
 120   1              DS1302_Time[3] = DecodeBCD(ReadByteFromDS1302(DS1302_HOUR));
 121   1              DS1302_Time[4] = DecodeBCD(ReadByteFromDS1302(DS1302_MINUTE));
 122   1              DS1302_Time[5] = DecodeBCD(ReadByteFromDS1302(DS1302_SECOND));
 123   1              DS1302_Time[6] = DecodeBCD(ReadByteFromDS1302(DS1302_DAY));
 124   1      }
 125          
 126          void main()
 127          {
 128   1              unsigned char Second;
 129   1              
 130   1              LCD_Init();
 131   1              InitDS1302();
 132   1              LCD_ShowString(1, 1, "  -  -  ");
 133   1              LCD_ShowString(2, 1, "  :  :  ");
 134   1              DS1302_SetTime();
 135   1              
 136   1              while (1)
 137   1              {
 138   2                      DS1302_ReadTime();
 139   2                      LCD_ShowNum(1, 1, DS1302_Time[0], 2);
 140   2                      LCD_ShowNum(1, 4, DS1302_Time[1], 2);
 141   2                      LCD_ShowNum(1, 7, DS1302_Time[2], 2);
 142   2                      LCD_ShowNum(2, 1, DS1302_Time[3], 2);
 143   2                      LCD_ShowNum(2, 4, DS1302_Time[4], 2);
 144   2                      LCD_ShowNum(2, 7, DS1302_Time[5], 2);
 145   2              }
 146   1      }
*** WARNING C280 IN LINE 128 OF main.c: 'Second': unreferenced local variable


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    527    ----
   CONSTANT SIZE    =     18    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
